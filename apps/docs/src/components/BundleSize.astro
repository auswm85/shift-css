---
import { gzipSync } from 'node:zlib';
import { readFileSync } from 'node:fs';
import { resolve, dirname } from 'node:path';
import { fileURLToPath } from 'node:url';

interface Props {
	/** Path to the CSS file relative to packages/core/dist/ */
	file?: string;
	/** Label to display (default: empty, just shows size) */
	label?: string;
}

const { file = 'shift.min.css', label = '' } = Astro.props;

// Resolve path to the core package's dist folder
const __dirname = dirname(fileURLToPath(import.meta.url));
const cssPath = resolve(__dirname, '../../../../packages/core/dist', file);

let sizeKB = '?';
try {
	const css = readFileSync(cssPath);
	const gzipped = gzipSync(css);
	const kb = gzipped.length / 1024;
	sizeKB = kb < 10 ? `~${kb.toFixed(1)}KB` : `~${Math.round(kb)}KB`;
} catch (e) {
	// File not found - show placeholder
	sizeKB = '~8KB';
}
---

<strong>{label}{sizeKB} gzipped</strong>
