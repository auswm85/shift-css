/**
 * Shift CSS - Card Component
 *
 * Flexible card component with header, body, footer sections.
 * Uses semantic attribute selectors and supports container queries.
 * Progressively enhanced with @scope for proper isolation of nested cards.
 *
 * Usage:
 *   <article s-card>Basic card content</article>
 *   <article s-card s-surface="raised">Elevated card</article>
 *   <article s-card s-interactive>Clickable card</article>
 *
 * Browser Support:
 *   - All browsers: Standard attribute selectors
 *   - Chrome 118+, Safari 17.4+: @scope for nested card isolation
 */

/* Base card - zero specificity for easy overrides */
:where([s-card]) {
  /* Card CSS properties (customization points) */
  --_card-bg: var(--s-surface-raised);
  --_card-border: var(--s-border-muted);
  --_card-radius: var(--s-radius-xl);
  --_card-shadow: var(--s-shadow-base);
  --_card-padding: var(--s-space-4);

  container-type: inline-size;

  display: flex;
  flex-direction: column;

  background-color: var(--_card-bg);
  border: 1px solid var(--_card-border);
  border-radius: var(--_card-radius);
  box-shadow: var(--_card-shadow);
  overflow: hidden;

  /* Auto-contrast text (0.55 threshold for WCAG 4.5:1) */
  color: var(--s-text-primary);

  @supports (color: oklch(from red l c h)) {
    color: oklch(
      from var(--_card-bg) clamp(0.15, calc((0.55 - l) * 1000 + 0.15), 0.95) 0 0
    );
  }
}

/* =============================================================================
   CARD SECTIONS
   ============================================================================= */

[s-card-header] {
  padding: var(--_card-padding, var(--s-space-4));
  border-bottom: 1px solid var(--_card-border, var(--s-border-muted));
}

[s-card-body] {
  padding: var(--_card-padding, var(--s-space-4));
  flex: 1;
}

[s-card-footer] {
  padding: var(--_card-padding, var(--s-space-4));
  border-top: 1px solid var(--_card-border, var(--s-border-muted));
}

/* Card media (image at top) */
[s-card-media] {
  aspect-ratio: 16 / 9;
  overflow: hidden;

  & > img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
}

/* Card title */
[s-card-title] {
  font-size: var(--s-text-lg);
  font-weight: var(--s-font-semibold);
  line-height: var(--s-leading-tight);
  margin-bottom: var(--s-space-1);
}

/* Card subtitle/description */
[s-card-subtitle] {
  font-size: var(--s-text-sm);
  color: var(--s-text-secondary);
}

/* =============================================================================
   CARD VARIANTS
   ============================================================================= */

/* Flat card (no shadow) */
[s-card="flat"] {
  --_card-shadow: none;
  --_card-border: var(--s-border-default);
}

/* Elevated card */
[s-card="elevated"],
[s-card][s-surface="raised"] {
  --_card-shadow: var(--s-shadow-lg);
  /* Use oklch transparent for RCS compatibility */
  --_card-border: oklch(0% 0 0 / 0);
}

/* Floating card (high elevation) */
[s-card][s-surface="floating"] {
  --_card-shadow: var(--s-shadow-xl);
  /* Use oklch transparent for RCS compatibility */
  --_card-border: oklch(0% 0 0 / 0);
}

/* Outline card */
[s-card="outline"] {
  --_card-shadow: none;
  --_card-border: var(--s-border-strong);
  --_card-bg: transparent;
}

/* =============================================================================
   CARD MODIFIERS
   ============================================================================= */

/* Interactive card */
[s-card][s-interactive] {
  cursor: pointer;
  transition:
    transform var(--s-duration-200) var(--s-ease-out),
    box-shadow var(--s-duration-200) var(--s-ease-out),
    border-color var(--s-duration-200) var(--s-ease-out);

  &:hover {
    transform: translateY(-4px);
    --_card-shadow: var(--s-shadow-xl);

    /* RCS: interactive depth - border darkens 10% on hover */
    @supports (color: oklch(from red l c h)) {
      border-color: oklch(from var(--_card-border) max(calc(l - 0.1), 0.05) c h);
    }
  }

  &:active {
    transform: translateY(-2px);
  }

  &:focus-visible {
    outline: 2px solid var(--s-focus-ring);
    outline-offset: 2px;
  }
}

/* Card with link overlay */
[s-card][s-link] {
  position: relative;

  & a::after {
    content: "";
    position: absolute;
    inset: 0;
  }
}

/* Horizontal card layout */
[s-card][s-horizontal] {
  flex-direction: row;

  & [s-card-media] {
    aspect-ratio: 1;
    width: 33%;
    flex-shrink: 0;
  }
}

/* Container query: Stack horizontal cards on small containers */
@container (max-width: 24rem) {
  [s-card][s-horizontal] {
    flex-direction: column;

    & [s-card-media] {
      width: 100%;
      aspect-ratio: 16 / 9;
    }
  }
}

/* =============================================================================
   CARD SIZE VARIANTS
   ============================================================================= */

[s-card][s-size="sm"] {
  --_card-padding: var(--s-space-3);
  --_card-radius: var(--s-radius-lg);
}

[s-card][s-size="lg"] {
  --_card-padding: var(--s-space-6);
}

/* Feature card (centered, larger padding) */
[s-card="feature"] {
  text-align: center;
  --_card-padding: var(--s-space-6);
}

[s-card-icon] {
  font-size: var(--s-text-4xl);
  margin-bottom: var(--s-space-4);
}

/* =============================================================================
   CARD LAYOUTS
   ============================================================================= */

/* Card grid */
[s-card-grid] {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(min(100%, 18rem), 1fr));
  gap: var(--s-space-4);
}

/* Card stack (vertical list) */
[s-card-stack] {
  display: flex;
  flex-direction: column;
  gap: var(--s-space-4);
}

/* =============================================================================
   STYLE QUERIES - Depth-Aware Adaptation
   Cards automatically adapt when nested inside surfaces of different depths.
   ============================================================================= */

@supports (container-type: inline-size) {
  /**
   * Inside raised surface (depth: 1)
   * Reduce shadow to avoid visual "shadow stacking"
   */
  @container surface style(--_surface-depth: 1) {
    :where([s-card]) {
      --_card-shadow: var(--s-shadow-sm);
    }
  }

  /**
   * Inside floating surface (depth: 2)
   * Remove shadow entirely, use subtle border for definition
   */
  @container surface style(--_surface-depth: 2) {
    :where([s-card]) {
      --_card-shadow: none;
      --_card-border: var(--s-border-default);
    }
  }

  /**
   * Inside sunken surface (depth: -1)
   * Increase shadow for better lift appearance
   */
  @container surface style(--_surface-depth: -1) {
    :where([s-card]) {
      --_card-shadow: var(--s-shadow-md);
    }
  }
}

/* =============================================================================
   CSS @SCOPE - Nested Card Isolation (Progressive Enhancement)

   When cards are nested inside other cards, this ensures that parent card
   styles (like borders and separators) don't bleed into child cards.
   Uses "donut scope" to exclude nested [s-card] elements.
   ============================================================================= */

@supports (selector(:scope)) {
  @scope ([s-card]) to ([s-card]) {
    /**
     * Scoped card sections - these styles only apply to direct card sections,
     * not sections inside nested cards.
     */

    /* Header with bottom border - only for this card's header */
    [s-card-header] {
      border-bottom: 1px solid var(--_card-border, var(--s-border-muted));
    }

    /* Footer with top border - only for this card's footer */
    [s-card-footer] {
      border-top: 1px solid var(--_card-border, var(--s-border-muted));
    }

    /* Typography inherits from scoped card context */
    [s-card-title] {
      color: inherit;
    }

    [s-card-subtitle] {
      color: var(--s-text-secondary);
    }

    /* Actions container scoped to this card */
    [s-card-actions] {
      display: flex;
      gap: var(--s-space-2);
      margin-top: var(--s-space-4);
    }
  }
}
