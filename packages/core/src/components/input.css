/**
 * Shift CSS - Input Component
 *
 * Form input styles using semantic attribute selectors.
 *
 * Usage:
 *   <input s-input type="text" placeholder="Enter text">
 *   <input s-input s-size="lg" type="email">
 *   <textarea s-input>Content</textarea>
 *   <select s-input><option>Choose...</option></select>
 */

/* Base input - zero specificity for easy overrides */
:where([s-input]) {
  /* Input CSS properties (customization points) */
  --_input-bg: var(--s-surface-base);
  --_input-border: var(--s-border-default);
  --_input-text: var(--s-text-primary);
  --_input-placeholder: var(--s-text-tertiary);
  --_input-radius: var(--s-radius-md);

  appearance: none;
  display: block;
  width: 100%;

  padding: var(--s-space-2) var(--s-space-3);
  background-color: var(--_input-bg);
  border: 2px solid var(--_input-border);
  border-radius: var(--_input-radius);
  color: var(--_input-text);
  font-size: var(--s-text-sm);
  line-height: var(--s-leading-normal);

  transition:
    border-color var(--s-duration-150) var(--s-ease-out),
    box-shadow var(--s-duration-150) var(--s-ease-out);

  &::placeholder {
    color: var(--_input-placeholder);
  }

  /* Hover state */
  &:hover:not(:disabled):not(:focus-visible) {
    --_input-border: var(--s-border-strong);
  }

  /* Focus state - use :focus-visible to avoid showing ring on mouse click */
  &:focus-visible {
    --_input-border: var(--s-interactive-primary);
    outline: 2px solid var(--s-focus-ring);
    outline-offset: 2px;

    /* RCS: contextual focus ring - 30% alpha of primary color */
    @supports (color: oklch(from red l c h)) {
      outline-color: oklch(from var(--s-interactive-primary) l c h / 0.3);
    }
  }

  /* Disabled state */
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-color: var(--s-surface-sunken);
  }

  /* Invalid state */
  &:invalid:not(:placeholder-shown),
  &[aria-invalid="true"] {
    --_input-border: var(--s-state-danger);

    &:focus-visible {
      outline-color: var(--s-state-danger);
    }
  }
}

/* =============================================================================
   INPUT SIZE VARIANTS
   ============================================================================= */

[s-input][s-size="sm"] {
  padding: var(--s-space-1) var(--s-space-2);
  font-size: var(--s-text-xs);
}

[s-input][s-size="lg"] {
  padding: var(--s-space-3) var(--s-space-4);
  font-size: var(--s-text-base);
}

/* =============================================================================
   SPECIFIC INPUT TYPES
   ============================================================================= */

/* Textarea */
textarea[s-input] {
  min-height: 6rem;
  resize: vertical;
}

/* Auto-sizing textarea - grows with content */
textarea[s-input][s-autosize] {
  resize: none;

  /* Progressive enhancement: field-sizing auto-grows with content */
  @supports (field-sizing: content) {
    field-sizing: content;
    min-height: 3lh; /* Minimum 3 lines using line-height units */
    max-height: 20lh; /* Maximum 20 lines before scrolling */
  }
}

/* Select */
select[s-input] {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right var(--s-space-3) center;
  padding-right: var(--s-space-10);
}

/* =============================================================================
   INPUT GROUP (with addons)
   ============================================================================= */

[s-input-group] {
  display: flex;

  & > [s-input] {
    flex: 1;
    min-width: 0;
    border-radius: 0;

    &:first-child {
      border-radius: var(--s-radius-md) 0 0 var(--s-radius-md);
    }

    &:last-child {
      border-radius: 0 var(--s-radius-md) var(--s-radius-md) 0;
    }
  }

  & > [s-input-addon] {
    display: flex;
    align-items: center;
    padding: var(--s-space-2) var(--s-space-3);
    background-color: var(--s-surface-sunken);
    border: 2px solid var(--s-border-default);
    color: var(--s-text-secondary);
    font-size: var(--s-text-sm);
    white-space: nowrap;

    &:first-child {
      border-radius: var(--s-radius-md) 0 0 var(--s-radius-md);
      border-right: none;
    }

    &:last-child {
      border-radius: 0 var(--s-radius-md) var(--s-radius-md) 0;
      border-left: none;
    }
  }
}

/* =============================================================================
   FORM FIELD WRAPPER
   ============================================================================= */

[s-field] {
  display: flex;
  flex-direction: column;
  gap: var(--s-space-1);
}

[s-field-label] {
  font-size: var(--s-text-sm);
  font-weight: var(--s-font-medium);
  color: var(--s-text-primary);
}

[s-field-hint] {
  font-size: var(--s-text-xs);
  color: var(--s-text-secondary);
}

[s-field-error] {
  font-size: var(--s-text-xs);
  color: var(--s-state-danger);
}

/* =============================================================================
   CHECKBOX / RADIO
   ============================================================================= */

[s-checkbox],
[s-radio] {
  display: inline-flex;
  align-items: center;
  gap: var(--s-space-2);
  cursor: pointer;

  & input {
    appearance: none;
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid var(--s-border-default);
    background-color: var(--s-surface-base);
    cursor: pointer;

    transition:
      background-color var(--s-duration-150) var(--s-ease-out),
      border-color var(--s-duration-150) var(--s-ease-out);

    &:checked {
      background-color: var(--s-interactive-primary);
      border-color: var(--s-interactive-primary);
    }

    &:focus-visible {
      outline: 2px solid var(--s-focus-ring);
      outline-offset: 2px;
    }

    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  }
}

[s-checkbox] input {
  border-radius: var(--s-radius-sm);

  &:checked {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='3'%3E%3Cpath d='M20 6L9 17l-5-5'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: center;
    background-size: 0.75rem;
  }
}

[s-radio] input {
  border-radius: 50%;

  &:checked {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='white'%3E%3Ccircle cx='12' cy='12' r='5'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: center;
  }
}

/* =============================================================================
   TOGGLE SWITCH
   ============================================================================= */

[s-toggle] {
  display: inline-flex;
  align-items: center;
  gap: var(--s-space-2);
  cursor: pointer;

  & input {
    appearance: none;
    width: 2.5rem;
    height: 1.5rem;
    border-radius: 9999px;
    background-color: var(--s-border-default);
    cursor: pointer;
    position: relative;

    transition: background-color var(--s-duration-200) var(--s-ease-out);

    &::after {
      content: "";
      position: absolute;
      top: 2px;
      left: 2px;
      width: calc(1.5rem - 4px);
      height: calc(1.5rem - 4px);
      border-radius: 50%;
      background-color: var(--s-surface-base);
      box-shadow: var(--s-shadow-sm);

      transition: transform var(--s-duration-200) var(--s-ease-out);
    }

    &:checked {
      background-color: var(--s-interactive-primary);

      &::after {
        transform: translateX(1rem);
      }
    }

    &:focus-visible {
      outline: 2px solid var(--s-focus-ring);
      outline-offset: 2px;
    }

    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  }
}

/* =============================================================================
   STYLE QUERIES - Depth-Aware Adaptation
   Inputs automatically adapt when nested inside surfaces of different depths.
   ============================================================================= */

@supports (container-type: inline-size) {
  /**
   * Inside raised surface (depth: 1)
   * Use sunken background to create visual depth contrast
   */
  @container surface style(--_surface-depth: 1) {
    :where([s-input]) {
      --_input-bg: var(--s-surface-sunken);
    }

    :where([s-checkbox]) input,
    :where([s-radio]) input {
      background-color: var(--s-surface-sunken);
    }
  }

  /**
   * Inside floating surface (depth: 2)
   * Stronger sunken appearance with visible border
   */
  @container surface style(--_surface-depth: 2) {
    :where([s-input]) {
      --_input-bg: var(--s-surface-sunken);
      --_input-border: var(--s-border-strong);
    }

    :where([s-checkbox]) input,
    :where([s-radio]) input {
      background-color: var(--s-surface-sunken);
      border-color: var(--s-border-strong);
    }
  }

  /**
   * Inside sunken surface (depth: -1)
   * Use base background to stand out from recessed area
   */
  @container surface style(--_surface-depth: -1) {
    :where([s-input]) {
      --_input-bg: var(--s-surface-raised);
      --_input-border: var(--s-border-muted);
    }

    :where([s-checkbox]) input,
    :where([s-radio]) input {
      background-color: var(--s-surface-raised);
    }
  }
}
