/**
 * Shift CSS - Button Component
 *
 * Accessible button styles using semantic attribute selectors.
 * Uses s-btn attribute for variants and s-size for scaling.
 *
 * Usage:
 *   <button s-btn="primary">Primary</button>
 *   <button s-btn="secondary">Secondary</button>
 *   <button s-btn="ghost">Ghost</button>
 *   <button s-btn="primary" s-size="lg">Large Primary</button>
 */

/* Base button - zero specificity for easy overrides */
:where([s-btn]) {
  /* Button CSS properties (customization points) */
  --_btn-bg: var(--s-interactive-primary);
  --_btn-text: var(--s-text-inverse);
  --_btn-border: transparent;

  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--s-space-2);

  padding: var(--s-space-2) var(--s-space-4);
  border-radius: var(--s-radius-md);
  font-weight: var(--s-font-semibold);
  font-size: var(--s-text-sm);
  line-height: 1;
  white-space: nowrap;

  background-color: var(--_btn-bg);
  color: var(--_btn-text);
  border: 1px solid var(--_btn-border);

  /* Auto-contrast for custom backgrounds (0.55 threshold for WCAG 4.5:1) */
  @supports (color: oklch(from red l c h)) {
    color: oklch(
      from var(--_btn-bg) clamp(0.15, calc((0.55 - l) * 1000 + 0.15), 0.95) 0 0
    );
  }

  @supports (color: contrast-color(red)) {
    color: contrast-color(var(--_btn-bg));
  }

  /* Transitions */
  transition:
    background-color var(--s-duration-150) var(--s-ease-out),
    border-color var(--s-duration-150) var(--s-ease-out),
    transform var(--s-duration-100) var(--s-ease-out);

  cursor: pointer;
  user-select: none;

  /* Hover state */
  &:hover:not(:disabled) {
    /* Fallback: semantic token */
    background-color: var(--s-interactive-primary-hover);

    /* RCS: derive hover from base color (works with custom colors)
       Light mode: darken (l * 0.92), Dark mode: lighten (l * 1.1, capped at 0.95) */
    @supports (color: oklch(from red l c h)) and (color: light-dark(red, blue)) {
      background-color: light-dark(
        oklch(from var(--_btn-bg) calc(l * 0.92) c h),
        oklch(from var(--_btn-bg) min(calc(l * 1.1), 0.95) c h)
      );
    }
  }

  /* Active state */
  &:active:not(:disabled) {
    /* Fallback: semantic token */
    background-color: var(--s-interactive-primary-active);

    /* RCS: derive active from base color
       Light mode: darken more, Dark mode: lighten more */
    @supports (color: oklch(from red l c h)) and (color: light-dark(red, blue)) {
      background-color: light-dark(
        oklch(from var(--_btn-bg) calc(l * 0.85) c h),
        oklch(from var(--_btn-bg) min(calc(l * 1.2), 0.98) c h)
      );
    }

    transform: scale(0.98);
  }

  /* Focus state */
  &:focus-visible {
    outline: 2px solid var(--s-focus-ring);
    outline-offset: 2px;
  }

  /* Disabled state */
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }
}

/* =============================================================================
   BUTTON VARIANTS (0,1,0 specificity - slightly sticky)
   ============================================================================= */

/* Primary - default, explicit declaration */
[s-btn="primary"] {
  --_btn-bg: var(--s-interactive-primary);
  --_btn-text: var(--s-text-inverse);
}

/* Secondary */
[s-btn="secondary"] {
  --_btn-bg: var(--s-surface-raised);
  --_btn-text: var(--s-text-primary);
  --_btn-border: var(--s-border-default);

  /* Override auto-contrast */
  color: var(--_btn-text);
}

/* Ghost - transparent background */
[s-btn="ghost"] {
  --_btn-bg: transparent;
  --_btn-text: var(--s-interactive-primary);

  /* Override auto-contrast for transparent bg */
  color: var(--_btn-text);

  &:hover:not(:disabled) {
    --_btn-bg: var(--s-surface-sunken);
  }
}

/* Link - looks like a link */
[s-btn="link"] {
  --_btn-bg: transparent;
  --_btn-text: var(--s-interactive-primary);
  --_btn-border: transparent;

  color: var(--_btn-text);
  text-decoration: underline;
  text-underline-offset: 2px;

  &:hover:not(:disabled) {
    --_btn-text: var(--s-interactive-primary-hover);
    color: var(--_btn-text);
  }
}

/* Outline - inverts on hover (special behavior, explicit override) */
[s-btn="outline"] {
  --_btn-bg: transparent;
  --_btn-text: var(--s-interactive-primary);
  --_btn-border: var(--s-interactive-primary);

  color: var(--_btn-text);

  &:hover:not(:disabled) {
    /* Update --_btn-bg so auto-contrast calculates correctly */
    --_btn-bg: var(--s-interactive-primary);
    background-color: var(--s-interactive-primary);
    color: var(--s-text-inverse);
  }
}

/* =============================================================================
   STATE VARIANTS
   ============================================================================= */

/* Danger - hover/active derived via RCS */
[s-btn="danger"] {
  --_btn-bg: var(--s-state-danger);
}

/* Success - hover/active derived via RCS */
[s-btn="success"] {
  --_btn-bg: var(--s-state-success);
}

/* Warning - hover/active derived via RCS */
[s-btn="warning"] {
  --_btn-bg: var(--s-state-warning);
}

/* =============================================================================
   SIZE MODIFIERS (composable via s-size attribute)
   ============================================================================= */

[s-btn][s-size="sm"] {
  padding: var(--s-space-1) var(--s-space-3);
  font-size: var(--s-text-xs);
}

[s-btn][s-size="lg"] {
  padding: var(--s-space-3) var(--s-space-6);
  font-size: var(--s-text-base);
}

[s-btn][s-size="xl"] {
  padding: var(--s-space-4) var(--s-space-8);
  font-size: var(--s-text-lg);
}

/* =============================================================================
   SPECIAL STATES
   ============================================================================= */

/* Icon-only button */
[s-btn][s-icon] {
  padding: var(--s-space-2);
  aspect-ratio: 1;
}

/* Full-width button */
[s-btn][s-block] {
  width: 100%;
}

/* Loading state - hide text with transparent color */
[s-btn][s-loading] {
  position: relative;
  color: transparent;
  pointer-events: none;

  &::after {
    content: "";
    position: absolute;
    inset: 0;
    margin: auto;
    width: 1em;
    height: 1em;
    border: 2px solid var(--s-text-inverse);
    border-right-color: transparent;
    border-radius: 50%;
    animation: s-btn-spin 0.6s linear infinite;
  }
}

@keyframes s-btn-spin {
  to {
    transform: rotate(360deg);
  }
}

/* =============================================================================
   BUTTON GROUP
   ============================================================================= */

[s-btn-group] {
  display: inline-flex;

  & > [s-btn] {
    border-radius: 0;

    &:first-child {
      border-radius: var(--s-radius-md) 0 0 var(--s-radius-md);
    }

    &:last-child {
      border-radius: 0 var(--s-radius-md) var(--s-radius-md) 0;
    }

    &:not(:last-child) {
      border-right: none;
    }
  }
}

/* =============================================================================
   STYLE QUERIES - Depth-Aware Adaptation
   Buttons automatically adapt when nested inside surfaces of different depths.
   ============================================================================= */

@supports (container-type: inline-size) {
  /**
   * Inside raised surface (depth: 1)
   * Secondary buttons need stronger border for definition
   */
  @container surface style(--_surface-depth: 1) {
    :where([s-btn="secondary"]) {
      --_btn-border: var(--s-border-strong);
    }
  }

  /**
   * Inside floating surface (depth: 2)
   * All buttons get stronger borders for definition against elevated bg
   */
  @container surface style(--_surface-depth: 2) {
    :where([s-btn="secondary"]) {
      --_btn-border: var(--s-border-strong);
      --_btn-bg: var(--s-surface-base);
    }

    :where([s-btn="ghost"]) {
      --_btn-border: var(--s-border-muted);
    }
  }

  /**
   * Inside sunken surface (depth: -1)
   * Buttons use base surface bg to stand out from recessed area
   */
  @container surface style(--_surface-depth: -1) {
    :where([s-btn="secondary"]) {
      --_btn-bg: var(--s-surface-base);
    }
  }
}
